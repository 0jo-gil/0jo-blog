{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/react-rollup-library/","result":{"data":{"markdownRemark":{"rawMarkdownBody":"\n\n다양한 프로젝트를 진행하면서 조금 더 생산성있고 확장 가능한 라이브러리 개발에 대한 필요성을 느꼈다.\nnpm에 배포된 다양한 라이브러리를 사용하면서 어떤 환경에서 개발되었는지, 어떤 방식으로 개발해야할지 고민을 했다.\n나름의 보일러플레이트를 만들어두고 환경을 구성하면서 겪었던 시행착오를 기록하려고 한다.\n\n추후 해당 보일러플레이트를 활용하여 나만의 디자인 시스템 라이브러리를 우선적으로 개발해보려고 한다.\n\n\n우선적으로, 사용하는 환경은 React, TypeScript, Rollup을 통한 개발이므로 필요 패키지 설치를 진행한다.\n\n\n### 1. React 환경\nReact, react-dom은 `peerDependencies`로 설치한다. (실제 패키지에 직접 import하지 않고 호환성이 필요한 경우)\n\n```\nyarn add --peer react react-dom\nyarn add -D @types/react @types/react-dom\n```\n\n---\n\n### 2. TypeScript 환경\n\n**TypeScript install**\n\n```\nyarn add -D typescript\n```\n\n\n**TypeScript 설정**\n\n루트 디렉토리에 tsconfig.json 파일을 생성하고 아래 내용을 추가한다.\n실제 필요한 설정은 각 프로젝트 성격에 맞게 설정하여 사용한다.\n\n```\n{\n  \"compilerOptions\": {\n    \"target\": \"es6\",\n    \"baseUrl\": \"./\",\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"strict\": true,\n    \"skipLibCheck\": true,\n    \"jsx\": \"react-jsx\",\n    \"module\": \"ESNext\",\n    \"declaration\": true,\n    \"declarationDir\": \"./dist\",\n    \"sourceMap\": true,\n    \"outDir\": \"./dist\",\n    \"moduleResolution\": \"node\",\n    \"allowSyntheticDefaultImports\": true,\n    \"emitDeclarationOnly\": true,\n    \"removeComments\": true\n  },\n  \"paths\": {\n    \"@/*\": [\"packages/*\"]\n  },\n  \"include\": [\n    \"src/**/*\",\n    \"**/*.tsx\",\n    \"packages\"\n  ],\n  \"exclude\": [\n    \"*.config.js\",\n    \"packages/**/node_modules/*.d.ts\",\n    \"**/dist/**/*\",\n    \"node_modules/*.d.ts\",\n  ],\n  \"types\": [\n    \"jest\"\n  ]\n}\n```\n\n---\n\n### 3. Rollup 환경\n\n**Rollup 플러그인 설치**\n\n```\nyarn add -D rollup rollup-plugin-typescript2 @rollup/plugin-commonjs @rollup/plugin-node-resolve rollup-plugin-peer-deps-external @rollup/plugin-imge @rollup/plugin-alias @rollup/plugin-babel\n```\n\n위에 알 수 없는 패키지 리스트를 `devDependencies` 로 설치했는데 리스트를 간단하게 정리하면 아래와 같다.\n\n- rollup-plugin-typescript2: TypeScript 파일을 컴파일하는 rollup 플러그인\n- @rollup/plugin-commonjs: CommonJS 모듈을 ES6로 변환하는 rollup 플러그인\n- @rollup/plugin-node-resolve: node_modules에서 모듈을 불러오는 rollup 플러그인\n- rollup-plugin-peer-deps-external: peerDependencies로 설치된 패키지를 external로 설정하는 rollup 플러그인 (번들링 결과에 포함하지 않고 import로 사용)\n- @rollup-plugin-image: 이미지 파일을 불러오는 rollup 플러그인\n\n\n**rollup.config.js**\n루트 디렉토리에 rollup.config.js 파일을 생성하고 아래 내용을 추가한다.\n\n```\nimport peerDepsExternal from 'rollup-plugin-peer-deps-external';\nimport resolve from '@rollup/plugin-node-resolve';\nimport commonjs from '@rollup/plugin-commonjs';\nimport typescript from '@rollup/plugin-typescript';\nimport babel from '@rollup/plugin-babel';\nimport postcss from 'rollup-plugin-postcss';\nimport dts from 'rollup-plugin-dts';\n\nconst packageJson = require('./package.json');\nconst extensions = ['js', 'jsx', 'ts', 'tsx'];\n\nexport default [\n  {\n    input: 'src/index.ts',\n    output: [\n      {\n        file: packageJson.main,\n        format: 'cjs',\n        sourcemap: true,\n      },\n      {\n        file: packageJson.module,\n        format: 'esm',\n        sourcemap: true,\n      },\n    ],\n    plugins: [\n      dts,\n      peerDepsExternal(),\n      resolve({ extensions }),\n      babel({\n        extensions,\n        include: ['packages/src/**/*'],\n        exclude: /node_modules/,\n        babelHelpers: 'runtime',\n      }),\n      commonjs({\n        include: /node_modules/,\n      }),\n      postcss({\n        extract: true,\n        extract: 'index.css',\n      }),\n      typescript({\n\n      })\n    ],\n    external: ['react', 'react-dom', 'styled-components']\n  }\n];\n```\n\n위 설정은 아래와 같은 역할을 한다.\n\n- `input`: 각 src/index.ts 파일을 받아와서 번들링한다.\n- `output`: 번들링 결과를 cjs, esm 형태로 내보낸다.\n- `extensions`: 번들링할 파일의 확장자를 지정한다.\n\n \n추가적으로 import한 다양한 라이브러리의 역할은 위 의존성 설치에서 설명한바와 같다.\n\n그리고 빌드를 위한 명령어를 package.json에 추가한다.\n\n```\n\"scripts\": {\n    ...\n    \"build\": \"rollup -c --bundleConfigAsCjs\",\n    ...\n}\n```\n\n---\n\n### 4. Babel 환경\n\nReact, styled-components를 활용할거라 Babel 환경을 구성한다.\n\n**Babel 플러그인 설치**\n\n```\nyarn add -D babel babel-plugin-styled-components babel-preset-react-app\n```\n\n\n**babel.config.js, babel.config.json**\n루트 디렉토리에 babel.config.js, babel.config.json 파일을 생성하고 아래 내용을 추가한다.\n\n\n```\n// babel.config.js\nmodule.exports = {\n    presets: [\n        require.resolve('@babel/preset-env'),\n        require.resolvwe('@babel/preset-typescript'),\n        [require.resolve('@babel/preset-react'), { runtime: 'automatic' }],\n    ],\n    plugins: [\n        'babel-plugin-styled-components',\n    ]\n}\n```\n\n```\n// babel.config.json\n{\n    \"testEnvironment\": \"jsdom\",\n    \"moduleFileExtensions\": [\n        \"js\",\n        \"jsx\"\n    ],\n    \"roots\": [\n        \"src\"\n    ],\n    \"moduleNameMapper\": {\n        \"src/(.*)\": \"<rootDir>/src/$1\",\n        \"\\\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga)$\": \"<rootDir>/__mocks__/fileMock.js\",\n        \"\\\\.(css|less)$\": \"<rootDir>/__mocks__/styleMock.js\"\n    },\n    \"transform\": {\n        \"\\\\.js$\": \"<rootDir>/node_modules/babel-jest\",\n        \"\\\\.jsx$\": \"<rootDir>/node_modules/babel-jest\"\n    },\n    \"plugins\": [\n        \"babel-plugin-styled-components\"\n    ]\n}\n```\n\n\n### 적용과정\n\n위 설정을 마쳤으면 packages 디렉토리에서 커스텀 라이브러리 개발을 진행하면 된다.\n\n디렉토리 구조는 아래와 같다.\n\n```\npackages/\n├── src/\n├──── index.ts\n...\n```\n\n위 디렉토리 구조에서 개발을 진행완료 했으면 위 설정한 빌드 명령어를 실행한다.\n\n``` \nyarn build\n```\n\n그러면 dist 디렉토리에 번들링 결과가 생성된다.\n\n\n### 마치면서\n실제 위 내용을 직접 적용하면서 '이렇게 사용해도 되나?'라고 생각이 들면서 우당탕탕 결과적으로 보일러 플레이트를 만들게 되었다.\nstyled-components를 같이 활용하기 위해서 babel 환경을 구성하는데 뭔가 애를 먹었지만 그래도 어렵지 않게 환경구성을 완료했다.\n\n위 보일러 플레이트를 기반으로 디자인 시스템 라이브러리를 직접 구축해보려고 한다.\n\n추후 라이브러리를 개발하면서 겪는 다양한 시행착오 역시 기록을 남겨보겠다.","frontmatter":{"title":"React Rollup 라이브러리","date":"2024-01-18","category":["React"],"slug":"react-rollup-library"}}},"pageContext":{"slug":"react-rollup-library"}},"staticQueryHashes":[],"slicesMap":{}}